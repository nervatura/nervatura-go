(this["webpackJsonpnervatura-client"]=this["webpackJsonpnervatura-client"]||[]).push([[5],{624:function(e,t,r){e.exports={title:"Login_title__1MXhE",version:"Login_version__1OfVs",modal:"Login_modal__1TGmh",middle:"Login_middle__X4tnk",dialog:"Login_dialog__2aZBW",animatezoom:"Login_animatezoom__1k02l"}},628:function(e,t,r){"use strict";r.r(t);var a=r(14),n=r(13),s=r(11),l=r.n(s),i=r(17),o=r(31),u=r(6),c=r(1),d=r.n(c),m=r(24),g=r(18),p=r(624),f=r.n(p),b=r(7),j=r(5),v=r(0),x=Object(u.memo)((function(e){var t=e.login,r=e.setTheme,a=e.SetLocale,n=e.session,s=n.version,l=n.configServer,i=e.data,o=i.username,u=i.database,c=e.theme,d=e.locales,m=e.lang;return Object(v.jsx)("div",{className:f.a.modal,children:Object(v.jsx)("div",{className:f.a.middle,children:Object(v.jsxs)("div",{className:"".concat(f.a.dialog," ").concat(c),children:[Object(v.jsxs)("div",{className:"row primary".concat(" ",f.a.title),children:[Object(v.jsx)("div",{className:"cell",children:Object(v.jsx)(b.d,{text:"title_login"})}),Object(v.jsx)("div",{className:"cell".concat(" ",f.a.version),children:Object(v.jsx)(b.d,{value:"v"+s})})]}),Object(v.jsxs)("div",{className:"row full section-small",children:[Object(v.jsxs)("div",{className:"row full section-small",children:[Object(v.jsxs)("div",{className:"row full",children:[Object(v.jsx)("div",{className:"padding-normal s12 m4 l4",children:Object(v.jsx)(b.d,{text:"login_username",className:"bold"})}),Object(v.jsx)("div",{className:"container s12 m8 l8",children:Object(v.jsx)(b.c,{id:"username",type:"text",className:"full",keys:["login","username"]})})]}),Object(v.jsxs)("div",{className:"row full",children:[Object(v.jsx)("div",{className:"padding-normal s12 m4 l4",children:Object(v.jsx)(b.d,{text:"login_password",className:"bold"})}),Object(v.jsx)("div",{className:"container s12 m8 l8",children:Object(v.jsx)(b.c,{id:"password",type:"password",className:"full",keys:["login","password"],onEnter:t})})]})]}),Object(v.jsxs)("div",{className:"row full section-small",children:[Object(v.jsxs)("div",{className:"row full",children:[Object(v.jsx)("div",{className:"padding-normal s12 m4 l4",children:Object(v.jsx)(b.d,{text:"login_database",className:"bold"})}),Object(v.jsx)("div",{className:"container s12 m8 l8",children:Object(v.jsx)(b.c,{id:"database",type:"text",className:"full",keys:["login","database"],onEnter:t})})]}),l?null:Object(v.jsxs)("div",{className:"row full",children:[Object(v.jsx)("div",{className:"padding-normal full",children:Object(v.jsx)(b.d,{text:"login_server",className:"bold"})}),Object(v.jsx)("div",{className:"container full",children:Object(v.jsx)(b.c,{id:"server",type:"text",className:"full",keys:["login","server"]})})]})]})]}),Object(v.jsxs)("div",{className:"row full section-small secondary-title",children:[Object(v.jsxs)("div",{className:"container section-small s6 m6 l6",children:[Object(v.jsx)("button",{className:"border-button",onClick:r,children:"dark"===c?Object(v.jsx)(j.nb,{}):Object(v.jsx)(j.Z,{})}),Object(v.jsx)(b.e,{id:"lang",value:m,options:Object.keys(d).map((function(e){return{value:e,text:d[e][e]||e}})),onChange:function(e){return a(e.target.value)}})]}),Object(v.jsx)("div",{className:"container section-small s6 m6 l6",children:Object(v.jsx)("button",{id:"login",autoFocus:!0,disabled:o&&0!==String(o).length&&u&&0!==String(u).length?"":"disabled",className:"primary full",onClick:t,children:Object(v.jsx)(b.d,{text:"login_login"})})})]})]})})})}),(function(e,t){return e.data===t.data&&e.theme===t.theme&&e.locales===t.locales&&e.lang===t.lang}));t.default=function(e){var t=Object(u.useContext)(m.b),r=t.data,s=t.setData,c=Object(g.e)(),p=Object(u.useState)({session:r.session}),f=Object(o.a)(p,1)[0];f.data=r.login,f.user=r.session.user,f.theme=r.current.theme,f.locales=r.session.locales,f.lang=r.current.lang;var b=function(){var e=Object(i.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",token:t.token,data:[{keys:{employee_id:t.employee.empnumber,logstate:"login"}}]},e.next=3,c.requestData("/log",r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(i.a)(l.a.mark((function e(t){var r,a,s,i,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d()({},{$set:{token:t.token,engine:t.engine}}),a=[{key:"employee",text:Object(g.a)(t.engine,{select:["e.*","ug.groupvalue as usergroupName","dp.groupvalue as departmentName"],from:"employee e",inner_join:["groups ug","on",["e.usergroup","=","ug.id"]],left_join:["groups dp","on",["e.department","=","dp.id"]],where:["username","=","?"]}).sql,values:[f.data.username]},{key:"menuCmds",text:Object(g.a)(t.engine,{select:["m.*","st.groupvalue as methodName"],from:"ui_menu m",inner_join:["groups st","on",["m.method","=","st.id"]]}).sql,values:[]},{key:"menuFields",text:Object(g.a)(t.engine,{select:["mf.*","ft.groupvalue as fieldtypeName"],from:"ui_menufields mf",inner_join:["groups ft","on",["mf.fieldtype","=","ft.id"]],order_by:["menu_id","orderby"]}).sql,values:[]},{key:"userlogin",text:Object(g.a)(t.engine,{select:["value"],from:"fieldvalue",where:[["ref_id","is","null"],["and","fieldname","=","'log_login'"]]}).sql,values:[]},{key:"groups",text:Object(g.a)(t.engine,{select:["*"],from:"groups",where:["groupname","in",[[],"'usergroup'","'nervatype'","'transtype'","'inputfilter'","'transfilter'","'department'","'logstate'","'fieldtype'","'service'"]]}).sql,values:[]}],s={method:"POST",token:t.token,data:a},e.next=5,c.requestData("/view",s);case 5:if(!(i=e.sent).error){e.next=8;break}return e.abrupt("return",i);case 8:return r=d()(r,{$merge:i}),r=d()(r,{$merge:{employee:r.employee[0],userlogin:r.userlogin.length>0?r.userlogin[0].value:"false"}}),a=[{key:"audit",text:Object(g.a)(t.engine,{select:["au.nervatype","nt.groupvalue as nervatypeName","au.subtype","case when nt.groupvalue = 'trans' then st.groupvalue else m.menukey end as subtypeName","au.inputfilter","ip.groupvalue as inputfilterName","au.supervisor"],from:"ui_audit au",inner_join:[["groups nt","on",["au.nervatype","=","nt.id"]],["groups ip","on",["au.inputfilter","=","ip.id"]]],left_join:[["groups st","on",["au.subtype","=","st.id"]],["ui_menu m","on",["au.subtype","=","m.id"]]],where:["au.usergroup","=","?"]}).sql,values:[r.employee.usergroup]},{key:"transfilter",text:Object(g.a)(t.engine,{select:["ref_id_2 as transfilter","g.groupvalue as transfilterName"],from:"link",inner_join:["groups g","on",["link.ref_id_2","=","g.id"]],where:[["ref_id_1","=","?"],["and","link.deleted","=","0"],["and","nervatype_1","in",[{select:["id"],from:"groups",where:[["groupname","=","'nervatype'"],["and","groupvalue","=","'groups'"]]}]],["and","nervatype_2","in",[{select:["id"],from:"groups",where:[["groupname","=","'nervatype'"],["and","groupvalue","=","'groups'"]]}]]]}).sql,values:[r.employee.usergroup]}],s={method:"POST",token:t.token,data:a},e.next=14,c.requestData("/view",s);case 14:if(!(i=e.sent).error){e.next=17;break}return e.abrupt("return",i);case 17:return null===(r=d()(r,{$merge:{transfilter:i.transfilter.length>0?i.transfilter[0].transfilter:null,audit:i.audit}})).transfilter?(o=r.groups.filter((function(e){return"transfilter"===e.groupname&&"all"===e.groupvalue}))[0],r=d()(r,{$merge:{transfilter:o.id,transfilterName:"all"}})):r=d()(r,{$merge:{transfilterName:i.transfilter[0].transfilterName}}),r=d()(r,{$merge:{audit_filter:{trans:{},menu:{},report:{}},edit_new:[[],[],[],[]]}}),[["offer",0],["order",0],["worksheet",0],["rent",0],["invoice",0],["receipt",0],["bank",1],["cash",1],["delivery",2],["inventory",2],["waybill",2],["production",2],["formula",2]].forEach((function(e){var t=r.audit.filter((function(t){return"trans"===t.nervatypeName&&t.subtypeName===e[0]}))[0];"disabled"!==(r=d()(r,{audit_filter:{trans:{$merge:Object(n.a)({},e[0],t?[t.inputfilterName,t.supervisor]:["all",1])}}})).audit_filter.trans[e[0]][0]&&(r=d()(r,{edit_new:Object(n.a)({},e[1],{$push:[e[0]]})}))})),["customer","product","employee","tool","project","setting","audit"].forEach((function(e){var t=r.audit.filter((function(t){return t.nervatypeName===e&&null===t.subtypeName}))[0];"disabled"!==(r=d()(r,{audit_filter:{$merge:Object(n.a)({},e,t?[t.inputfilterName,t.supervisor]:["all",1])}})).audit_filter[e][0]&&"setting"!==e&&"audit"!==e&&(r=d()(r,{edit_new:{3:{$push:[e]}}}))})),e.abrupt("return",r);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return f.login=Object(i.a)(l.a.mark((function e(){var t,a,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"POST",data:{username:f.data.username,password:f.data.password,database:f.data.database}},e.next=3,c.requestData("/auth/login",t);case 3:if(!(a=e.sent).token||!a.engine){e.next=28;break}if(r.session.engines.includes(a.engine)){e.next=7;break}return e.abrupt("return",c.resultError({error:{message:c.getText("login_engine_err")}}));case 7:if(r.session.service.includes(a.version)){e.next=9;break}return e.abrupt("return",c.resultError({error:{message:c.getText("login_version_err")}}));case 9:return e.next=11,j(a);case 11:if(!(n=e.sent).error){e.next=14;break}return e.abrupt("return",c.resultError(n));case 14:if("t"!==n.userlogin&&"true"!==n.userlogin){e.next=20;break}return e.next=17,b(n);case 17:if(!(i=e.sent).error){e.next=20;break}return e.abrupt("return",c.resultError(i));case 20:s("current",{module:"search"}),s("login",{data:n}),localStorage.setItem("database",f.data.database),localStorage.setItem("username",f.data.username),localStorage.setItem("server",f.data.server),c.loadBookmark({user_id:n.employee.id,token:a.token}),e.next=29;break;case 28:c.resultError(a);case 29:case"end":return e.stop()}}),e)}))),f.setTheme=function(){var e="light"===f.theme?"dark":"light";s("current",{theme:e}),localStorage.setItem("theme",e)},f.SetLocale=function(e){s("current",{lang:e}),localStorage.setItem("lang",e)},Object(v.jsx)(x,Object(a.a)({},f))}}}]);