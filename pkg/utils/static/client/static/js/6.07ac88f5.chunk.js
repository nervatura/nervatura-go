(this["webpackJsonpnervatura-client"]=this["webpackJsonpnervatura-client"]||[]).push([[6],{623:function(e,t,a){e.exports={searchCol:"Search_searchCol__2O8-d",barButton:"Search_barButton__27JrW",selected:"Search_selected__2UHar",dropdownBox:"Search_dropdownBox__3EUAY",filterDelete:"Search_filterDelete__Dv0yY",dropdownContent:"Search_dropdownContent__u_7WD",opac:"Search_opac__cG3Bt",dropItem:"Search_dropItem__2ctUF",active:"Search_active__NcfRo",filterPanel:"Search_filterPanel__1gR-v",resultTitle:"Search_resultTitle__1qYKw",resultTitlePlus:"Search_resultTitlePlus__2wSdI",editCol:"Search_editCol__2qwQ0",colBox:"Search_colBox__LC-5r",selectCol:"Search_selectCol__31Xco",closeIcon:"Search_closeIcon__3Wpxk"}},627:function(e,t,a){"use strict";a.r(t);var r=a(14),l=a(181);var n=a(194);function c(e){return function(e){if(Array.isArray(e))return Object(l.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(n.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var s=a(11),i=a.n(s),o=a(17),d=a(13),u=a(31),b=a(6),f=a(1),j=a.n(f),h=a(28),p=a(24),m=a(18),v=a(77),O=a(62),w=a(130),x=a(623),g=a.n(x),_=a(7),y=a(41),k=a(5),N=a(149),C=a(0),F=Object(b.memo)((function(e){var t=e.browserFilter,a=e.dropDown,r=e.showBrowser,l=e.getText,n=e.browserView,c=e.onEdit,s=e.setColumns,i=e.showColumns,o=e.addFilter,u=e.editFilter,b=e.deleteFilter,f=e.checkTotalFields,h=e.showTotal,p=e.exportResult,m=e.setActions,v=e.bookmarkSave,O=e.showHelp,w=e.onPage,x=e.ui,y=x.paginationPage,F=x.dateFormat,E=x.timeFormat,S=x.filter_opt_1,T=x.filter_opt_2,q=e.queries,$=e.current,B=e.data,I=B.vkey,D=B.view,A=B.browser_filter,P=B.dropdown,R=B.result,L=B.columns,M=B.filters,U=B.deffield,J=B.page,K=q[I](),V=K[D],H={view:{columnDef:{property:"view",cell:{props:{style:{width:25,padding:"7px 3px 3px 8px"}},formatters:[function(e,t){var a=t.rowData;return V.readonly?Object(C.jsx)(k.l,{width:9,height:24}):Object(C.jsx)(k.B,{width:24,height:21.3,onClick:function(){return c("id",a.id,a)},className:g.a.editCol})}]}}}};Object.keys(V.fields).forEach((function(e){if(L[D][e])switch(V.fields[e].fieldtype){case"float":case"integer":H=j()(H,{$merge:Object(d.a)({},e,{fieldtype:"number",label:V.fields[e].label})});break;case"bool":H=j()(H,{$merge:Object(d.a)({},e,{fieldtype:"bool",label:V.fields[e].label})});break;case"string":H="deffield_value"===e?j()(H,{$merge:Object(d.a)({},e,{fieldtype:"deffield",label:V.fields[e].label})}):j()(H,{$merge:Object(d.a)({},e,{fieldtype:"string",label:V.fields[e].label})});break;default:H=j()(H,{$merge:Object(d.a)({},e,{fieldtype:"string",label:V.fields[e].label})})}}));var Y=f(V.fields,U);return Object(C.jsx)("div",{className:"page padding-normal".concat(" ",$.theme),children:Object(C.jsxs)("div",{className:"panel",children:[Object(C.jsx)("div",{className:"panel-title primary",children:Object(C.jsx)(_.d,{bold:!0,primary:!0,xxxlarge:!0,text:"browser_"+I})}),Object(C.jsxs)("div",{className:"section container",children:[Object(C.jsx)("div",{className:"row full",children:Object(C.jsx)("div",{className:"cell",children:Object(C.jsx)("button",{className:"full primary",onClick:t,children:Object(C.jsx)(_.d,{value:V.label,leftIcon:Object(C.jsx)(k.G,{})})})})}),A?Object(C.jsxs)("div",{className:"".concat(g.a.filterPanel," ","border"),children:[Object(C.jsxs)("div",{className:"row full section-small",children:[Object(C.jsx)("div",{className:"cell",children:Object(C.jsx)("button",{className:"border-button".concat(" ",g.a.barButton),onClick:function(){return n()},children:Object(C.jsx)(_.d,{className:"hide-small",text:"browser_search",leftIcon:Object(C.jsx)(k.gb,{height:"18",width:"18"})})})}),Object(C.jsxs)("div",{className:"cell align-right",children:[Object(C.jsx)("button",{className:"border-button small-button".concat(" ",g.a.barButton),onClick:function(){return v()},children:Object(C.jsx)(_.d,{text:"browser_bookmark",leftIcon:Object(C.jsx)(k.lb,{height:"14",width:"15.75"})})}),Object(C.jsx)("button",{className:"border-button small-button".concat(" ",g.a.barButton),disabled:0===R.length?"disabled":"",onClick:function(){return p(V.fields)},children:Object(C.jsx)(_.d,{text:"browser_export",leftIcon:Object(C.jsx)(k.A,{height:"14",width:"14"})})}),Object(C.jsx)("button",{className:"border-button small-button".concat(" ",g.a.barButton),onClick:function(){return O("browser")},children:Object(C.jsx)(_.d,{text:"browser_help",leftIcon:Object(C.jsx)(k.db,{height:"14",width:"14"})})})]})]}),Object(C.jsx)("div",{className:"row full section-small",children:Object(C.jsxs)("div",{className:"cell",children:[Object(C.jsxs)("div",{className:"".concat(g.a.dropdownBox),children:[Object(C.jsx)("button",{className:"border-button".concat(" ",g.a.barButton," ").concat(P===I+"_view"?g.a.selected:""),onClick:function(){return a(I+"_view")},children:Object(C.jsx)(_.d,{className:"hide-small",text:"browser_views",leftIcon:Object(C.jsx)(k.E,{height:"18",width:"20.25"})})}),P===I+"_view"?Object(C.jsx)("div",{className:"".concat(g.a.dropdownContent," ","border"," ").concat($.theme," "),children:Object.keys(K).map((function(e,t){return"options"!==e?Object(C.jsx)("div",{onClick:function(){return r(I,e)},className:"".concat(g.a.dropItem," ").concat(e===D?g.a.active:null),children:Object(C.jsx)(_.d,{value:K[e].label,leftIcon:e===D?Object(C.jsx)(k.n,{}):Object(C.jsx)(k.E,{})})},t):null}))}):null]}),Object(C.jsx)("button",{className:"border-button".concat(" ",g.a.barButton),onClick:i,children:Object(C.jsx)(_.d,{className:"hide-small",text:"browser_columns",leftIcon:Object(C.jsx)(k.u,{height:"18",width:"18"})})}),Object(C.jsx)("button",{className:"border-button".concat(" ",g.a.barButton),onClick:o,children:Object(C.jsx)(_.d,{className:"hide-small",text:"browser_filter",leftIcon:Object(C.jsx)(k.bb,{height:"18",width:"15.75"})})}),Object(C.jsx)("button",{className:"border-button".concat(" ",g.a.barButton),disabled:0===Y.count||0===R.length?"disabled":"",onClick:function(){return h(V.fields,Y)},children:Object(C.jsx)(_.d,{className:"hide-small",text:"browser_total",leftIcon:Object(C.jsx)(k.N,{height:"18",width:"18"})})})]})}),e.data[I+"_columns"]?Object(C.jsx)("div",{className:"".concat(g.a.colBox," ","border"),children:Object.keys(V.fields).map((function(e){return Object(C.jsx)("div",{className:"cell padding-tiny tiny left".concat(" \n                  ",!0===L[D][e]?g.a.selectCol:g.a.editCol),onClick:function(){return s(e,!(!0===L[D][e]))},children:Object(C.jsx)(_.d,{value:V.fields[e].label,leftIcon:!0===L[D][e]?Object(C.jsx)(k.p,{}):Object(C.jsx)(k.kb,{})})},e)}))}):null,M[D].map((function(e,t){return Object(C.jsxs)("div",{className:"section-small-top",children:[Object(C.jsx)("div",{className:"cell",children:Object(C.jsx)(_.e,{value:e.fieldname,onChange:function(e){return u(t,"fieldname",e.target.value)},options:Object.keys(V.fields).filter((function(e){return"id"!==e&&"_id"!==e})).flatMap((function(e){return"deffield_value"===e?U.map((function(e){return{value:e.fieldname,text:l(e.fieldname,e.description)}})):{value:e,text:V.fields[e].label}}))})}),Object(C.jsx)("div",{className:"cell",children:Object(C.jsx)(_.e,{value:e.filtertype,onChange:function(e){return u(t,"filtertype",e.target.value)},options:(["date","float","integer"].includes(e.fieldtype)?T:S).map((function(e){return{value:e[0],text:e[1]}}))})}),Object(C.jsxs)("div",{className:"cell mobile",children:["==N"!==e.filtertype?Object(C.jsxs)("div",{className:"cell",children:["bool"===e.fieldtype?Object(C.jsx)(_.e,{value:e.value,onChange:function(e){return u(t,"value",e.target.value)},options:[{value:0,text:l("label_no")},{value:1,text:l("label_yes")}]}):null,"integer"===e.fieldtype||"float"===e.fieldtype?Object(C.jsx)(_.c,{value:e.value,onChange:function(e){return u(t,"value",e.target.value)},itype:e.fieldtype,className:"align-right"}):null,"date"===e.fieldtype?Object(C.jsx)(_.a,{value:e.value,onChange:function(e){return u(t,"value",e)}}):null,"string"===e.fieldtype?Object(C.jsx)(_.c,{value:e.value,onChange:function(e){return u(t,"value",e.target.value)}}):null]}):null,Object(C.jsx)("div",{className:"cell",children:Object(C.jsx)("button",{className:" ".concat("border-button"," ",g.a.filterDelete),onClick:function(){return b(t)},children:Object(C.jsx)(k.tb,{})})})]})]},t)}))]}):null,Object(C.jsx)("div",{className:"row full section-small-top",children:Object(C.jsxs)("div",{className:"row full border",children:[Object(C.jsxs)("div",{className:"cell".concat(" ",g.a.resultTitle),children:[R.length," ",Object(C.jsx)(_.d,{text:"browser_result"})]}),V.actions_new?Object(C.jsx)("div",{className:"cell".concat(" ",g.a.resultTitlePlus),children:Object(C.jsx)("button",{className:"small-button",onClick:function(){return m(V.actions_new)},children:Object(C.jsx)(k.bb,{})})}):null]})}),Object(C.jsx)("div",{className:"row full",children:Object(C.jsx)(N.a,{rowKey:"row_id",fields:H,rows:R,filterPlaceholder:l("placeholder_filter"),labelYes:l("label_yes"),labelNo:l("label_no"),dateFormat:F,timeFormat:E,paginationPage:y,paginationTop:!0,onEditCell:c,currentPage:J||1,onCurrentPage:w})})]})]})})}),(function(e,t){return e.data===t.data&&e.data.update===t.data.update})),E=Object(b.memo)((function(e){var t=e.current;return Object(C.jsx)("div",{className:"page padding-normal".concat(" ",t.theme),children:Object(C.jsx)(y.g,Object(r.a)({},e))})}),(function(e,t){return e.data===t.data})),S=a(25);t.default=function(e){var t=Object(b.useContext)(p.b),a=t.data,l=t.setData,n=Object(v.a)(),s=Object(O.a)(),f=Object(w.a)(),x=Object(m.e)(),g=Object(S.l)(),_=Object(b.useState)({engine:a.login.data.engine,queries:f,ui:x.getSetting("ui"),showHelp:x.showHelp}),y=Object(u.a)(_,1)[0];y.data=a.search,y.current=a.current,y.getText=function(e,t){return x.getText(e,t)},y.editRow=function(e,t){var a=e.id.split("/"),r=j()({},{$set:{ntype:a[0],ttype:a[1],id:parseInt(a[2],10),item:e}});"servercmd"===r.ntype?n.showServerCmd(r.id):s.checkEditor(r,"LOAD_EDITOR")},y.setActions=function(e,t){s.setFormActions(e,t)},y.onEdit=function(e,t,a){var r=t.split("/"),l=j()({},{$set:{ntype:r[0],ttype:r[1],id:r[2]}});"id"===e&&(l=j()(l,{$merge:{form:a.form,form_id:a.form_id}})),s.checkEditor(l,"LOAD_EDITOR")},y.onPage=function(e){l("search",{page:e})},y.setColumns=function(e,t){var a=j()(y.data.columns,{});t?a=j()(a,Object(d.a)({},y.data.view,{$merge:Object(d.a)({},e,!0)})):(delete a[y.data.view][e],a=j()(a,{$merge:Object(d.a)({},y.data.view,a[y.data.view])})),l("search",{columns:a,update:(new Date).getTime()})},y.showColumns=function(){l("search",Object(d.a)({},y.data.vkey+"_columns",!y.data[y.data.vkey+"_columns"]))};var k=function(e){switch(e){case"date":return Object(h.a)(new Date,{representation:"date"});case"bool":case"integer":case"float":return 0;default:return""}};return y.addFilter=function(){var e=y.queries[y.data.vkey]()[y.data.view],t=e.fields[Object.keys(e.fields)[0]],a=j()(y.data.filters,{});a=j()(a,Object(d.a)({},y.data.view,{$push:[{id:(new Date).getTime().toString(),fieldtype:t.fieldtype,fieldname:Object.keys(e.fields)[0],sqlstr:t.sqlstr,wheretype:t.wheretype,filtertype:"===",value:k(t.fieldtype)}]})),l("search",{filters:a})},y.deleteFilter=function(e){var t=j()(y.data.filters,{});t=j()(t,Object(d.a)({},y.data.view,{$splice:[[e,1]]})),l("search",{filters:t})},y.editFilter=function(e,t,a){var r=y.queries[y.data.vkey]()[y.data.view],n=j()(y.data.filters,{});switch(t){case"filtertype":case"value":n=j()(n,Object(d.a)({},y.data.view,Object(d.a)({},e,{$merge:Object(d.a)({},t,a)})));break;case"fieldname":if(Object.keys(r.fields).includes(a)){var c=r.fields[a];n=j()(n,Object(d.a)({},y.data.view,Object(d.a)({},e,{$merge:{fieldname:a,fieldtype:c.fieldtype,sqlstr:c.sqlstr,wheretype:c.wheretype,filtertype:"===",value:k(c.fieldtype)}})))}else{var s=y.data.deffield.filter((function(e){return e.fieldname===a}))[0];if(s){var i="string",o="fv.value ";switch(s.fieldtype){case"bool":i="bool",o="fg.groupvalue='bool' and case when fv.value='true' then 1 else 0 end ";break;case"integer":i="integer",o="fg.groupvalue='integer' and {FMSF_NUMBER} {CAS_INT}fv.value {CAE_INT} {FMEF_CONVERT} ";break;case"float":i="float",o="fg.groupvalue='float' and {FMSF_NUMBER} {CAS_FLOAT}fv.value {CAE_FLOAT} {FMEF_CONVERT} ";break;case"date":i="date",o="fg.groupvalue='date' and {FMSF_DATE} {CASF_DATE}fv.value{CAEF_DATE} {FMEF_CONVERT} ";break;case"customer":i="string",o="rf_customer.custname ";break;case"tool":i="string",o="rf_tool.serial ";break;case"product":i="string",o="rf_product.partnumber ";break;case"trans":case"transitem":case"transmovement":case"transpayment":i="string",o="rf_trans.transnumber ";break;case"project":i="string",o="rf_project.pronumber ";break;case"employee":i="string",o="rf_employee.empnumber ";break;case"place":i="string",o="rf_place.planumber ";break;default:i="string",o="fv.value "}n=j()(n,Object(d.a)({},y.data.view,Object(d.a)({},e,{$merge:{fieldname:s.fieldname,fieldlimit:["and","fv.fieldname","=","'"+s.fieldname+"'"],fieldtype:i,sqlstr:o,wheretype:"where",filtertype:"===",value:""}})))}}}l("search",{filters:n})},y.browserFilter=function(){l("search",{browser_filter:!y.data.browser_filter})},y.dropDown=function(e){l("search",{dropdown:y.data.dropdown===e?"":e})},y.showBrowser=function(e,t){n.showBrowser(e,t)},y.quickSearch=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.quickSearch(y.data.qview,y.data.qfilter);case 2:if(!(t=e.sent).error){e.next=5;break}return e.abrupt("return",x.resultError(t));case 5:l("search",{result:t.result});case 6:case"end":return e.stop()}}),e)}))),y.browserView=Object(o.a)(i.a.mark((function e(){var t,a,r,s,o,d,u,b,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.queries[y.data.vkey]()[y.data.view],a=j()({},{$set:t.sql}),r=[],s=function(e){switch("==N"!==e.filtertype&&r.push(e.value),e.filtertype){case"===":"string"===e.fieldtype?o.push(["and",["lower("+e.sqlstr+")","like","{CCS}{JOKER}{SEP}lower(?){SEP}{JOKER}{CCE}"]]):o.push(["and",[e.sqlstr,"=","?"]]);break;case"==N":"string"===e.fieldtype?o.push(["and",[[e.sqlstr,"like","''"],["or",e.sqlstr,"is null"]]]):o.push(["and",e.sqlstr," is null"]);break;case"!==":"string"===e.fieldtype?o.push(["and",["lower("+e.sqlstr+")","not like","{CCS}{JOKER}{SEP}lower(?){SEP}{JOKER}{CCE}"]]):o.push(["and",[e.sqlstr,"<>","?"]]);break;case">==":o.push(["and",[e.sqlstr,">=","?"]]);break;case"<==":o.push(["and",[e.sqlstr,"<=","?"]])}},o=[],y.data.filters[y.data.view].filter((function(e){return"where"===e.wheretype})).forEach((function(e){s(e)})),o.length>0&&(a=j()(a,{where:{$push:c(o)}})),o=[],y.data.filters[y.data.view].filter((function(e){return"having"===e.wheretype})).forEach((function(e){s(e)})),o.length>0&&(a=j()(a,{having:{$push:c(o)}})),(o=n.getDataFilter(y.data.vkey,[],y.data.view)).length>0&&(a=j()(a,{where:{$push:[o]}})),(d=n.getUserFilter(y.data.vkey)).where.length>0&&(a=j()(a,{where:{$push:d.where}}),r=r.concat(d.params)),u=[{key:"result",text:Object(m.a)(y.engine,a).sql,values:r}],b={method:"POST",data:u},e.next=18,x.requestData("/view",b);case 18:if(!(f=e.sent).error){e.next=21;break}return e.abrupt("return",x.resultError(f));case 21:l("search",{result:f.result,dropdown:"",page:1});case 22:case"end":return e.stop()}}),e)}))),y.checkTotalFields=function(e,t){var a={totalFields:{},totalLabels:{},count:0};return t&&Object.keys(e).includes("deffield_value")?t.filter((function(e){return"integer"===e.fieldtype||"float"===e.fieldtype})).forEach((function(e){a=j()(a,{totalFields:{$merge:Object(d.a)({},e.fieldname,0)},totalLabels:{$merge:Object(d.a)({},e.fieldname,e.description)}})})):Object.keys(e).filter((function(t){return("integer"===e[t].fieldtype||"float"===e[t].fieldtype)&&"avg"!==e[t].calc})).forEach((function(t){a=j()(a,{totalFields:{$merge:Object(d.a)({},t,0)},totalLabels:{$merge:Object(d.a)({},t,e[t].label)}})})),a=j()(a,{$merge:{count:Object.keys(a.totalFields).length}})},y.showTotal=function(e,t){var a=!1,r=Object.keys(e).includes("deffield_value"),n=function(e){return isNaN(parseFloat(e))?0:parseFloat(e)};y.data.result.forEach((function(e){r?"undefined"!==typeof t.totalFields[e.fieldname]&&(a=!0,t=j()(t,{totalFields:{$merge:Object(d.a)({},e.fieldname,t.totalFields[e.fieldname]+n(e.export_deffield_value))}})):(a=!0,Object.keys(t.totalFields).forEach((function(a){t="undefined"!==typeof e["export_"+a]?j()(t,{totalFields:{$merge:Object(d.a)({},a,t.totalFields[a]+n(e["export_"+a]))}}):j()(t,{totalFields:{$merge:Object(d.a)({},a,t.totalFields[a]+n(e[a]))}})})))})),a&&g({total:t,onChange:function(e){l("current",{modalForm:e})},cbCancel:function(){l("current",{modalForm:null})}})},y.exportResult=function(e){var t=y.data.view+".csv",a="",r=Object.keys(e).map((function(t){return e[t].label}));a+=r.join(y.ui.export_sep)+"\n",y.data.result.forEach((function(t){var r=Object.keys(e).map((function(e){return"undefined"!=typeof t["export_"+e]?t["export_"+e]:t[e]}));a+=r.join(y.ui.export_sep)+"\n"}));var l=URL.createObjectURL(new Blob([a],{type:"text/csv;charset=utf-8;"}));Object(m.d)(l,t)},y.bookmarkSave=function(){x.saveBookmark(["browser",f[a.search.vkey]()[a.search.view].label])},y.data.vkey?Object(C.jsx)(F,Object(r.a)({},y)):Object(C.jsx)(E,Object(r.a)({},y))}}}]);